import sys
import os
import json
from curl_cffi import requests

# Ensure project root is in path
sys.path.append(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))

from lib.common.executor import run_request
from lib.device_profile import DEFAULT_PROFILE

# Reference Data Index: 3
# Method: POST
#
# Original Headers (Comparison):
# ------------------------------
# {
#     'x-timestamp': '1767976275393',
#     'coupang-app': 'COUPANG|Android|15|9.0.4||null|f0b740d2-3447-3b2b-b118-d66257275f8f|Y|SM-A165N|f0b740d234472b2bb118d66257275f8f||XXHDPI|17679762746194168937968||0||wifi|-1|||Asia/Seoul|||1080|450|-1|1.0|true',
#     'x-coupang-font-scale': '1.0',
#     'run-mode': 'production',
#     'x-coupang-app-request': 'true',
#     'x-cp-app-req-time': '1767976275392',
#     'x-coupang-target-market': 'KR',
#     'x-coupang-app-name': 'coupang',
#     'x-cp-app-id': 'com.coupang.mobile',
#     'x-cmg-dco': '',
#     'x-coupang-origin-region': 'KR',
#     'x-signature': 'd03571268ed646ec4be1039112c62bb1643e1691dc9d2f36981f517f62c6da90',
#     'x-coupang-accept-language': 'ko-KR',
#     'x-trace-ix-id': '00014a5c-5554-5d91-02d6-a65fc4db903f',
#     'user-agent': 'Dalvik/2.1.0 (Linux; U; Android 15; SM-A165N Build/AP3A.240905.015.A2)',
#     'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',
#     'content-length': '4028',
#     'accept-encoding': 'gzip'
# }
# ------------------------------

def run(session: requests.Session):
    url = "https://cmapi.coupang.com/v3/ablist"
    method = "POST"
    
    headers = {
        'x-timestamp': '1767976275393',
        'coupang-app': 'COUPANG|Android|15|9.0.4||null|f0b740d2-3447-3b2b-b118-d66257275f8f|Y|SM-A165N|f0b740d234472b2bb118d66257275f8f||XXHDPI|17679762746194168937968||0||wifi|-1|||Asia/Seoul|||1080|450|-1|1.0|true',
        'x-coupang-font-scale': '1.0',
        'run-mode': 'production',
        'x-coupang-app-request': 'true',
        'x-cp-app-req-time': '1767976275392',
        'x-coupang-target-market': 'KR',
        'x-coupang-app-name': 'coupang',
        'x-cp-app-id': 'com.coupang.mobile',
        'x-cmg-dco': '',
        'x-coupang-origin-region': 'KR',
        'x-signature': 'd03571268ed646ec4be1039112c62bb1643e1691dc9d2f36981f517f62c6da90',
        'x-coupang-accept-language': 'ko-KR',
        'x-trace-ix-id': '00014a5c-5554-5d91-02d6-a65fc4db903f',
        'user-agent': 'Dalvik/2.1.0 (Linux; U; Android 15; SM-A165N Build/AP3A.240905.015.A2)',
        'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'content-length': '4028',
        'accept-encoding': 'gzip'
    }
    
    body = 'key=10492%2C14554%2C73721%2C81938%2C82811%2C89786%2C87714%2C89433%2C90464%2C93502%2C94019%2C94694%2C92945%2C94261%2C96190%2C95958%2C96179%2C96180%2C26958%2C32864%2C32214%2C39806%2C86271%2C86614%2C93244%2C93317%2C88444%2C88057%2C94128%2C95717%2C50054%2C92291%2C89022%2C89859%2C95164%2C95709%2C24501%2C25471%2C26660%2C32203%2C83745%2C93009%2C94290%2C92551%2C8667%2C9921%2C16014%2C32950%2C47313%2C47314%2C82452%2C95667%2C96150%2C96151%2C95869%2C95100%2C91144%2C91145%2C95186%2C90266%2C90267%2C94820%2C95562%2C92672%2C92673%2C96511%2C96528%2C95515%2C18408%2C18071%2C27857%2C27864%2C33578%2C34123%2C39710%2C40462%2C44896%2C56100%2C56675%2C54948%2C56280%2C64293%2C77795%2C80445%2C80444%2C81991%2C81997%2C82032%2C95522%2C85809%2C85810%2C83703%2C83704%2C83308%2C90627%2C88632%2C88633%2C89019%2C94995%2C83990%2C86026%2C86740%2C86741%2C93197%2C94628%2C95992%2C93125%2C94373%2C87696%2C87697%2C95678%2C92680%2C94882%2C90209%2C89942%2C91880%2C89941%2C88164%2C88166%2C89943%2C89726%2C90659%2C90824%2C92492%2C93860%2C94589%2C94815%2C88192%2C89528%2C90762%2C92836%2C94290%2C91730%2C91912%2C92499%2C96108%2C93744%2C91586%2C94538%2C95406%2C94457%2C94690%2C95561%2C95523%2C95010%2C96305%2C96304%2C96109%2C90541%2C90542%2C92918%2C92919%2C92916%2C92917%2C71893%2C78491%2C84432%2C84433%2C86299%2C86308%2C87054%2C87196%2C89090%2C89091%2C91185%2C91622%2C90437%2C90439%2C94531%2C82411%2C82413%2C82416%2C82418%2C89596%2C89598%2C80918%2C80919%2C91762%2C91763%2C83263%2C83265%2C82740%2C82741%2C86491%2C86492%2C87499%2C87500%2C87081%2C87082%2C82661%2C82678%2C82199%2C82200%2C85376%2C83384%2C83392%2C83393%2C95076%2C92393%2C95711%2C81719%2C81728%2C87777%2C87778%2C87855%2C87856%2C86060%2C91599%2C83319%2C83328%2C84722%2C84724%2C92762%2C93755%2C86700%2C86701%2C84896%2C84897%2C83232%2C83233%2C84204%2C84207%2C88118%2C88119%2C87847%2C87846%2C88094%2C88095%2C85160%2C85163%2C84202%2C84203%2C84527%2C84615%2C95161%2C90573%2C92461%2C95563%2C96224%2C86883%2C86884%2C84475%2C84476%2C84239%2C84233%2C85096%2C85097%2C92992%2C88586%2C88571%2C86801%2C86802%2C85062%2C85063%2C85158%2C85200%2C95337%2C85333%2C85334%2C85919%2C83320%2C86646%2C86647%2C88597%2C87096%2C87097%2C88393%2C88394%2C88259%2C88260%2C87486%2C87489%2C88152%2C88153%2C89716%2C89718%2C88775%2C88776%2C88343%2C88344%2C88348%2C88349%2C88690%2C88691%2C88721%2C88720%2C88930%2C88932%2C88473%2C88474%2C88936%2C88939%2C87849%2C87850%2C89056%2C89058%2C90410%2C91882%2C91883%2C91981%2C95121%2C92295%2C92297%2C91048%2C95107%2C92577%2C91113%2C91114%2C91518%2C91526%2C94088%2C92126%2C92127%2C91795%2C91796%2C93238%2C93878%2C85412%2C85413%2C93177%2C92147%2C92223%2C94975%2C95284%2C92957%2C92958%2C92959%2C92960%2C92579%2C92583%2C92591%2C92592%2C92805%2C92807%2C92806%2C92808%2C92801%2C92803%2C92802%2C92804%2C93048%2C93911%2C93758%2C93618%2C95151%2C95491%2C93428%2C93763%2C93765%2C93766%2C95638%2C93728%2C94647%2C94646%2C94648%2C95512%2C95519%2C95520%2C95521%2C93835%2C93838%2C94625%2C94196%2C95957%2C95032%2C95033%2C95112%2C95435%2C95510%2C95511%2C92543%2C93908%2C93910%2C94615%2C94948%2C95876%2C95849%2C95926%2C95927%2C96303%2C96313%2C96252%2C96438%2C21908%2C7899%2C10097%2C78512%2C81204%2C81205%2C94842%2C80069%2C80070%2C82045%2C82048%2C82046%2C82047%2C85662%2C85663%2C92182%2C95648%2C94331%2C86738%2C86739%2C93867%2C94210%2C86961%2C86962%2C83011%2C94322%2C95313%2C95647%2C31274%2C31719%2C37054%2C37055%2C53529%2C86237%2C86238%2C86782%2C86786%2C87491%2C88256%2C90830%2C91794%2C94453%2C95575%2C96230%2C96254%2C87534%2C87535%2C87537%2C87538%2C87223%2C87224%2C84334%2C96195%2C86872%2C86873%2C89316%2C93125%2C91530%2C91531%2C91715%2C92194%2C92195%2C92544%2C92545%2C92819%2C92820%2C92206%2C4139%2C79990%2C79991%2C3625%2C5379%2C18418%2C81667%2C88164%2C88166%2C92946%2C93811%2C94523%2C33974%2C35665%2C75959%2C75961%2C85948%2C85950%2C92685%2C93617%2C81553%2C87135%2C87137%2C86337%2C86338%2C80820%2C80822%2C89461%2C88736%2C88737%2C91801%2C95420%2C88689%2C94898%2C89962%2C89964%2C89483%2C89484%2C91192%2C91193%2C89472%2C89473%2C86300%2C86301%2C95649%2C96016%2C95856%2C95875%2C95489%2C95514%2C95194%2C94861%2C93938%2C24298&'
    
    return run_request(session, method, url, headers, body)
